<!-- build time:Sun Jan 06 2019 10:55:10 GMT+0800 (中国标准时间) --><!DOCTYPE html><html><head><link rel="manifest" href="/manifest.json"><link rel="manifest" href="/manifest.json"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-86912728-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-86912728-1")</script><meta charset="utf-8"><meta name="google-site-verification" content="cBcBWhl7Hp2NPKeg5_qo8xR4lkndlOiIXGrPymbwJEs"><link rel="canonical" href="http://wuyang910217.github.io//2016/08/06/deploy-meteor-app.html"><title>超简单，利用Passenger部署Meteor到Ubuntu14.04服务器 | wuyang的个人博客 | Live long and Prosper!</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#3F51B5"><meta name="keywords" content="meteor,passenger"><meta name="description" content="简介目前能够方便地部署Meteor app的方法还不多，一般都是用官网的Galaxy或者meteor up或者按照部署Nodejs服务器的方式。而如果我们想要使用Nginx作为Web服务器，其中配置的步骤又很繁琐，那有没有好的开源项目或者平台能够帮助我们减轻痛苦呢？答案是必须的。下面就隆重请出今天的主角——PhusionPassenger"><meta name="keywords" content="meteor,passenger"><meta property="og:type" content="article"><meta property="og:title" content="超简单，利用Passenger部署Meteor到Ubuntu14.04服务器"><meta property="og:url" content="http://wuyang910217.github.io/2016/08/06/deploy-meteor-app.html"><meta property="og:site_name" content="wuyang的个人博客"><meta property="og:description" content="简介目前能够方便地部署Meteor app的方法还不多，一般都是用官网的Galaxy或者meteor up或者按照部署Nodejs服务器的方式。而如果我们想要使用Nginx作为Web服务器，其中配置的步骤又很繁琐，那有没有好的开源项目或者平台能够帮助我们减轻痛苦呢？答案是必须的。下面就隆重请出今天的主角——PhusionPassenger"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://image.wangjuntao.com/passenger.png?imageView2/2/w/600/h/300/interlace/0/q/100"><meta property="og:updated_time" content="2019-01-06T02:29:18.169Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="超简单，利用Passenger部署Meteor到Ubuntu14.04服务器"><meta name="twitter:description" content="简介目前能够方便地部署Meteor app的方法还不多，一般都是用官网的Galaxy或者meteor up或者按照部署Nodejs服务器的方式。而如果我们想要使用Nginx作为Web服务器，其中配置的步骤又很繁琐，那有没有好的开源项目或者平台能够帮助我们减轻痛苦呢？答案是必须的。下面就隆重请出今天的主角——PhusionPassenger"><meta name="twitter:image" content="http://image.wangjuntao.com/passenger.png?imageView2/2/w/600/h/300/interlace/0/q/100"><link rel="alternative" href="/atom.xml" title="wuyang的个人博客" type="application/atom+xml"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@1.5.2/css/style.css"><script>window.lazyScripts=[]</script></head><body><div id="loading" class="active"></div><aside id="menu" class="hide"><div class="inner flex-row-vertical"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off"><i class="icon icon-lg icon-close"></i></a><div class="brand-wrap" style="background-image:url(/img/brand.jpg)"><div class="brand"><a href="/" class="avatar waves-effect waves-circle waves-light"><img src="/img/avatar.jpg"></a><hgroup class="introduce"><h5 class="nickname">wuyang</h5><a href="mailto:wuyang910217@gmail.com" title="wuyang910217@gmail.com" class="mail">wuyang910217@gmail.com</a></hgroup></div></div><div class="scroll-wrap flex-col"><ul class="nav"><li class="waves-block waves-effect"><a href="/"><i class="icon icon-lg icon-home"></i> 主页</a></li><li class="waves-block waves-effect"><a href="/archives"><i class="icon icon-lg icon-archives"></i> 归档</a></li><li class="waves-block waves-effect"><a href="/tags"><i class="icon icon-lg icon-tags"></i> 标签</a></li><li class="waves-block waves-effect"><a href="/categories"><i class="icon icon-lg icon-th-list"></i> 分类</a></li><li class="waves-block waves-effect"><a href="https://github.com/wuyang910217" target="_blank"><i class="icon icon-lg icon-github"></i> Github</a></li><li class="waves-block waves-effect"><a href="https://twitter.com/wuyangJT" target="_blank"><i class="icon icon-lg icon-twitter"></i> Twitter</a></li></ul></div></div></aside><main id="main"><header class="top-header" id="header"><div class="flex-row"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle"><i class="icon icon-lg icon-navicon"></i></a><div class="flex-col header-title ellipsis">超简单，利用Passenger部署Meteor到Ubuntu14.04服务器</div><div class="search-wrap" id="search-wrap"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg icon-chevron-left"></i> </a><input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字"> <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search"><i class="icon icon-lg icon-search"></i></a></div><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare"><i class="icon icon-lg icon-share-alt"></i></a></div></header><header class="content-header post-header"><div class="container fade-scale"><h1 class="title">超简单，利用Passenger部署Meteor到Ubuntu14.04服务器</h1><h5 class="subtitle"><time datetime="2016-08-06T11:19:30.000Z" itemprop="datePublished" class="page-time">2016-08-06</time><ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Tech/">Tech</a></li></ul></h5></div></header><div class="container body-wrap"><aside class="post-widget"><nav class="post-toc-wrap" id="post-toc"><h4>TOC</h4><ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#简介"><span class="post-toc-number">1.</span> <span class="post-toc-text">简介</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Passenger简介"><span class="post-toc-number">2.</span> <span class="post-toc-text">Passenger简介</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#步骤一-选择一台云服务器"><span class="post-toc-number">3.</span> <span class="post-toc-text">步骤一 选择一台云服务器</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#步骤二-选择Passenger集成包"><span class="post-toc-number">4.</span> <span class="post-toc-text">步骤二 选择Passenger集成包</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#步骤三-选择Passenger版本"><span class="post-toc-number">5.</span> <span class="post-toc-text">步骤三 选择Passenger版本</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#步骤四-安装Nodejs环境"><span class="post-toc-number">6.</span> <span class="post-toc-text">步骤四 安装Nodejs环境</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#步骤五-安装Passenger"><span class="post-toc-number">7.</span> <span class="post-toc-text">步骤五 安装Passenger</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#步骤六-部署Meteor-App"><span class="post-toc-number">8.</span> <span class="post-toc-text">步骤六 部署Meteor App</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#步骤七-你的程序需要更新时"><span class="post-toc-number">9.</span> <span class="post-toc-text">步骤七 你的程序需要更新时</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#接下来"><span class="post-toc-number">10.</span> <span class="post-toc-text">接下来</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#总结"><span class="post-toc-number">11.</span> <span class="post-toc-text">总结</span></a></li></ol></nav></aside><article id="post-deploy-meteor-app" class="post-article article-type-post fade" itemprop="blogPost"><div class="post-card"><h1 class="post-card-title">超简单，利用Passenger部署Meteor到Ubuntu14.04服务器</h1><div class="post-meta"><time class="post-time" title="2016年08月06日 19:19" datetime="2016-08-06T11:19:30.000Z" itemprop="datePublished">2016-08-06</time><ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Tech/">Tech</a></li></ul><span id="busuanzi_container_page_pv" title="文章总阅读量" style="display:none"><i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span></span></div><div class="post-content" id="post-content" itemprop="postContent"><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>目前能够方便地部署Meteor app的方法还不多，一般都是用官网的<code>Galaxy</code>或者<code>meteor up</code>或者按照部署<code>Nodejs</code>服务器的方式。而如果我们想要使用<code>Nginx</code>作为Web服务器，其中配置的步骤又很繁琐，那有没有好的开源项目或者平台能够帮助我们减轻痛苦呢？答案是必须的。下面就隆重请出今天的主角——<code>PhusionPassenger</code><a id="more"></a>。</p><h3 id="Passenger简介"><a href="#Passenger简介" class="headerlink" title="Passenger简介"></a>Passenger简介</h3><figure class="image-bubble"><div class="img-lightbox"><div class="overlay"></div><img src="http://image.wangjuntao.com/passenger.png?imageView2/2/w/600/h/300/interlace/0/q/100" alt="passenger"></div><div class="image-caption">passenger</div></figure><p><strong>Passenger</strong> 想必对于<code>Rails</code>开发者都很熟悉了，使用<code>Passenger+Apache/Nginx</code>配置<code>Rails Web</code>程序也是主流之一。</p><p><strong>没想到如今竟然也支持<code>Meteor</code>了</strong>（其实不止Meteor，还支持Nodejs和Python）。从他的官网介绍中可以看到——<code>A web server and application server for your web apps</code>，其实就是整合了web服务器和后端语言所需要的各种依赖包。而且他的官网有非常详细的教程，本文就是按照此教程一步步走下来的，其中也记录了我部署过程中遇到的一些问题和解决方法。话不多说，首先奉上地址：</p><ul><li>Passenger官网 <a href="https://www.phusionpassenger.com/" target="_blank" rel="noopener">点我</a></li><li>Meteor部署详细步骤地址 <a href="https://www.phusionpassenger.com/library/walkthroughs/deploy/meteor/" target="_blank" rel="noopener">点我</a></li><li>Github项目wiki地址 <a href="https://github.com/phusion/passenger/wiki" target="_blank" rel="noopener">点我</a></li></ul><h3 id="步骤一-选择一台云服务器"><a href="#步骤一-选择一台云服务器" class="headerlink" title="步骤一 选择一台云服务器"></a>步骤一 选择一台云服务器</h3><p>国外一般用亚马逊或Digital Ocean的云服务器，这里我们就选择通用的运行Linux的服务器，配置差不多都一样。我使用的是阿里云运行Ubuntu14.04的服务器，当然CentOS也支持。</p><h3 id="步骤二-选择Passenger集成包"><a href="#步骤二-选择Passenger集成包" class="headerlink" title="步骤二 选择Passenger集成包"></a>步骤二 选择Passenger集成包</h3><p>官网总共提供了三种模式：与Nginx集成，与Apache集成，Standalone。三种模式的介绍与区别大家看官网，这里我选择了Nginx集成模式。</p><h3 id="步骤三-选择Passenger版本"><a href="#步骤三-选择Passenger版本" class="headerlink" title="步骤三 选择Passenger版本"></a>步骤三 选择Passenger版本</h3><p>有开源版和企业版，企业版要收费的，所以我选择了<code>open source</code>。</p><h3 id="步骤四-安装Nodejs环境"><a href="#步骤四-安装Nodejs环境" class="headerlink" title="步骤四 安装Nodejs环境"></a>步骤四 安装Nodejs环境</h3><p><strong>说明 以下都是在你买的服务器上操作的</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install -y curl apt-transport-https ca-certificates &amp;&amp;</span><br><span class="line">curl --fail -ssL -o setup-nodejs https://deb.nodesource.com/setup_0.12 &amp;&amp;</span><br><span class="line">sudo bash setup-nodejs &amp;&amp;</span><br><span class="line">sudo apt-get install -y nodejs build-essential</span><br></pre></td></tr></table></figure><p>经过此过程，安装的Nodejs版本是<strong>0.12.10</strong>，大家也可以从<a href="https://github.com/nodesource/distributions" target="_blank" rel="noopener">NodeSource</a>安装其他的版本如v4.3.1，或者使用<a href="https://github.com/creationix/nvm" target="_blank" rel="noopener">nvm</a>版本管理脚本。不过一开始在我尝试使用更高的版本时，老是出问题，后来发现<strong>Meteor不支持更高的Nodejs版本</strong>，所以大家尽量使用v0.12或者以下的版本吧！</p><p>另外，使用<code>nvm</code>版本管理安装的Nodejs，其实安装到了你的用户目录下，以后使用不需要<code>sudo</code>命令，方便。而上面的步骤会全局安装Nodejs，以后安装包时，会出现权限问题，大家自行选择。</p><h3 id="步骤五-安装Passenger"><a href="#步骤五-安装Passenger" class="headerlink" title="步骤五 安装Passenger"></a>步骤五 安装Passenger</h3><p>还是先选择你的服务器安装的系统类型和版本，这里我选择的是Ubuntu14.04.开始安装：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 添加钥匙和apt包</span><br><span class="line">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 561F9B9CAC40B2F7</span><br><span class="line">sudo apt-get install -y apt-transport-https ca-certificates</span><br><span class="line">sudo sh -c &apos;echo deb https://oss-binaries.phusionpassenger.com/apt/passenger trusty main &gt; /etc/apt/sources.list.d/passenger.list&apos;</span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line"># 安装Passenger和Nginx</span><br><span class="line">sudo apt-get install -y nginx-extras passenger</span><br></pre></td></tr></table></figure><p>安装完成后,打开<code>vim /etc/nginx/nginx.conf</code>,并取消下面两行的注释：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># passenger_root /some-filename/locations.ini;</span><br><span class="line"># passenger_ruby /usr/bin/passenger_free_ruby;</span><br></pre></td></tr></table></figure><p>然后重启Nginx服务器：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx restart</span><br></pre></td></tr></table></figure><p>查看是否安装成功：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/bin/passenger-config validate-install</span><br></pre></td></tr></table></figure><p>查看Passenger运行情况(不是必须)：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/sbin/passenger-memory-stats</span><br></pre></td></tr></table></figure><p>最后重新执行一下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure><p>目前都还是准备工作，下面开始上正餐了。</p><h3 id="步骤六-部署Meteor-App"><a href="#步骤六-部署Meteor-App" class="headerlink" title="步骤六 部署Meteor App"></a>步骤六 部署Meteor App</h3><p><strong>说明 以下操作是在你的本地机器上</strong></p><p>首先打包你的Meteor程序包<code>meteor bundle package.tar.gz</code>,此处使用的是<code>bundle</code>命令，会出现提示说这个命令已经被<code>build</code>命令取代了，不过这里因为<code>build</code>命令会把<code>iOS and Android</code>移动平台的包一起打包进去，而我们并不需要。<code>package.tar.gz</code>是你取的压缩包的名字和格式。执行结束后，会在当前目录下生成。<br>然后传到服务器上：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp package.tar.gz  adminuser@yourserver.com:</span><br><span class="line"># 例如（最好使用IP地址，注意最后的冒号）</span><br><span class="line">scp package.tar.gz root@120.24.72.4:</span><br></pre></td></tr></table></figure><p>登陆到服务器：<code>ssh root@120.24.72.4</code>(需要先下载ssh)</p><p><strong>说明 以下操作是在你的远程服务器上</strong></p><p>首先创建一个普通用户如<code>blog</code>（如果你以前已经创建过，可以省略这一步），按照提示输入密码（<strong>注意：不是你的root账户密码</strong>）<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adduser blog</span><br></pre></td></tr></table></figure><p></p><p>然后确保以后可以不用密码登陆服务器（不是必须）<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p ~blog/.ssh</span><br><span class="line">touch $HOME/.ssh/authorized_keys</span><br><span class="line">sudo sh -c &quot;cat $HOME/.ssh/authorized_keys &gt;&gt; ~blog/.ssh/authorized_keys&quot;</span><br><span class="line">sudo chown -R blog: ~blog/.ssh</span><br><span class="line">sudo chmod 700 ~blog/.ssh</span><br><span class="line">sudo sh -c &quot;chmod 600 ~blog/.ssh/*&quot;</span><br></pre></td></tr></table></figure><p></p><p>现在<code>blog</code>用户是没有root权限的，不能使用<code>sudo</code>命令，最好把<code>blog</code>添加到<code>sudoers</code>里，输入<code>visudo</code>，找到：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># User privilege specification</span><br><span class="line">root    ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure><p></p><p>在下面添加一句：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># User privilege specification</span><br><span class="line">root    ALL=(ALL:ALL) ALL</span><br><span class="line">blog     ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure><p></p><p>切换到<code>blog</code>用户（以后直接使用这个用户就行，不用在使用root）<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u blog -H bash -l</span><br></pre></td></tr></table></figure><p></p><p>然后你就能使用<code>sudo</code>命令了，<strong>注意，你的root用户密码不要和你的普通用户密码一样，以后需要输入密码时，直接输入普遍用户的<br>密码就可以了，不需要再使用root用户的密码。</strong></p><p>接下来：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 创建程序使用的目录（名字任意）</span><br><span class="line">sudo mkdir -p /var/www/blog</span><br><span class="line"># 然后进入</span><br><span class="line">cd /var/www/blog/</span><br><span class="line"># 解压到此目录</span><br><span class="line">sudo tar zxf ~/package.tar.gz</span><br></pre></td></tr></table></figure><p></p><p>安装<code>mongodb</code><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y mongodb</span><br></pre></td></tr></table></figure><p></p><p>此处最好进入到<code>/bundle</code>目录下，创建两个空目录,后面要用到<code>public</code>目录，<br>而<code>tmp</code>目录可以创建<code>restart.txt</code>文件，用于Nginx重启（现在不需要）：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir tmp public</span><br></pre></td></tr></table></figure><p></p><p>接着进入到<code>cd /programs/server</code>目录下，执行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install --production</span><br></pre></td></tr></table></figure><p>安装完成后，创建<code>Nginx</code>配置文件：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-enabled/blog.conf</span><br><span class="line"># 后面的文件名任意</span><br></pre></td></tr></table></figure><p></p><p>写入如下内容：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name yourserver.com;</span><br><span class="line">    # 写你的域名 或者直接写IP</span><br><span class="line"></span><br><span class="line">    # 你的程序的public目录，就是刚才创建的空目录</span><br><span class="line">    root /var/www/blog/bundle/public;</span><br><span class="line"></span><br><span class="line">    # 开启Passenger</span><br><span class="line">    passenger_enabled on;</span><br><span class="line">    # 说明是个meteor app</span><br><span class="line">    passenger_app_type node;</span><br><span class="line">    passenger_startup_file main.js;</span><br><span class="line"></span><br><span class="line">    # MongoDB的位置，此处不用改就可以，后面的文件名任意，但不能有&apos;.&apos;，如myapp.db</span><br><span class="line">    passenger_env_var MONGO_URL mongodb://localhost:27017/blogdb;</span><br><span class="line">    # 你的根url，也可以是IP</span><br><span class="line">    passenger_env_var ROOT_URL http://yourserver.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>最后重启<code>Nginx</code><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx restart</span><br></pre></td></tr></table></figure><p></p><p>然后你可以访问你的网站了：</p><ol><li>如果能直接访问，那只有恭喜你了</li><li>如果显示<code>500</code>错误，说明<code>Passenger</code>配置过程出错，没有启动，你可以再仔细从头来一遍</li><li>如果出现<code>Passenger</code>提示的错误信息，如<code>We&#39;re sorry, but something went wrong.</code>说明Passenger启动了，但是程序内部有误，我就是在第三种情况下困扰了好久，这时就要查看<code>Nginx</code>错误日志了：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cat /var/log/nginx/error.log</span><br></pre></td></tr></table></figure><p>也可以查看<code>Passenger</code>的输出信息，在<code>/var/log/</code>目录下，有很多<code>html</code>文件，你可以用<code>cat</code>命令查看。然后根据错误信息Google之，可能遇到的问题不一样，下面是我遇到的：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/your-app-path/bundle/programs/server/node_modules/fibers/future.js:245</span><br><span class="line">                        throw(ex);</span><br><span class="line">                              ^</span><br><span class="line">Error: Module did not self-register.</span><br><span class="line">    at Error (native)</span><br><span class="line">    at Module.load (module.js:355:32)</span><br><span class="line">    at Function.Module._load (module.js:310:12)</span><br><span class="line">    at Module.require (module.js:365:17)</span><br><span class="line">    at require (module.js:384:17)</span><br><span class="line">    at bindings (/your-app-path/bundle/programs/server/npm/npm</span><br><span class="line">      -bcrypt/node_modules/bcrypt/node_modules/</span><br><span class="line">      bindings/bindings.js:74:15)</span><br><span class="line">    at Object.&amp;lt;anonymous&amp;gt; (/your-app-path/bundle/programs/server/npm/</span><br><span class="line">      npm-bcrypt/node_modules/bcrypt/bcrypt.js:3:35)</span><br><span class="line">    at Module._compile (module.js:460:26)</span><br><span class="line">    at Object.Module._extensions..js (module.js:478:10)</span><br><span class="line">    at Module.load (module.js:355:32)</span><br></pre></td></tr></table></figure><p></p><p>在网上搜了许多方法，归纳一下就是这两个包<code>fibers</code>和<code>bcrypt</code>的依赖关系，需要重新安装，不过我试了N多遍，还是不行，就在我要放弃的时候，<br>又重新仔细看了一遍错误原因，才发现<code>bcrypt</code>这个包的位置不在<code>bundle/programs/server/node_modules/</code>目录下，而是在<code>/bundle/programs/server/npm/npm-bcrypt/node_modules/</code>目录下，然后瞬间看到一丝希望，赶忙删除<code>/bcrypt</code>这个目录，重新运行<code>npm install bcrypt</code>安装了新的包，最后<br>重启<code>Nginx</code>，访问我的域名，真的就成功了。此刻，我真的想哭。<strong>泪的教训：看错误日志一定要仔细，仔细，再仔细</strong></p><p>总结一下：</p><ol><li>运行<code>npm install --production</code>后，<code>fibers</code>和<code>bcrypt</code>这两个包应该就在正确的位置了</li><li>但由于依赖问题（我猜）不能工作，安装的<code>fibers</code>的版本是<code>1.0.5</code>，<code>bcrypt</code>的版本是<code>0.7.8</code></li><li>所以我只把<code>/bundle/programs/server/npm/npm-bcrypt/node_modules/</code>目录下的<code>/bcrypt</code>文件夹删除</li><li>然后重新安装<code>npm install bcrypt</code>（注意是在这目录下），就会安装<code>0.8.5版本</code>的<code>bcrypt</code>了</li><li>然后问题就能解决，最后重启<code>Nginx</code></li><li>注意我没有重新安装<code>fibers</code>包</li></ol><h3 id="步骤七-你的程序需要更新时"><a href="#步骤七-你的程序需要更新时" class="headerlink" title="步骤七  你的程序需要更新时"></a>步骤七 你的程序需要更新时</h3><p>当我们更新程序后，需要上传新的打包好的文件，并再次部署，也可以编写自动化脚本，帮助你处理。这部分内容请大家直接看官网的步骤，我这里不再赘述了。</p><h3 id="接下来"><a href="#接下来" class="headerlink" title="接下来"></a>接下来</h3><p><code>Passenger</code>还能做更多，比如一台服务器可以同时运行多个<code>Meteor app</code>，监控你的内存和CPU，更多的配置项和优化功能，错误处理和调试等。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>可以看到，使用<code>Passenger</code>真的很方便，不用再头疼<code>Nginx</code> 的配置了，极大地节省了你的时间，强烈推荐大家使用。</p><p>如果你遇到了其他问题，并且不能解决，可以联系我。</p></div><blockquote class="post-copyright"><div class="content"><span class="post-time">最后更新时间：<time datetime="2019-01-06T02:29:18.169Z" itemprop="dateUpdated">2019年1月6日 10:29</time></span><br>转载请注明出处：<a href="/2016/08/06/deploy-meteor-app.html" target="_blank" rel="external">http://wuyang910217.github.io/2016/08/06/deploy-meteor-app.html</a></div><footer><a href="http://wuyang910217.github.io"><img src="/img/avatar.jpg" alt="wuyang"> wuyang</a></footer></blockquote><div class="page-reward"><a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a></div><div class="post-footer"><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/meteor/">meteor</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/passenger/">passenger</a></li></ul><div class="page-share-wrap"><div class="page-share" id="pageShare"><ul class="reset share-icons"><li><a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://wuyang910217.github.io/2016/08/06/deploy-meteor-app.html&title=《超简单，利用Passenger部署Meteor到Ubuntu14.04服务器》 — wuyang的个人博客&pic=http://wuyang910217.github.io/img/avatar.jpg" data-title="微博"><i class="icon icon-weibo"></i></a></li><li><a class="weixin share-sns wxFab" href="javascript:;" data-title="微信"><i class="icon icon-weixin"></i></a></li><li><a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://wuyang910217.github.io/2016/08/06/deploy-meteor-app.html&title=《超简单，利用Passenger部署Meteor到Ubuntu14.04服务器》 — wuyang的个人博客&source=简介目前能够方便地部署Meteor app的方法还不多，一般都是用官网的Galaxy或者meteor up或者按照部署Nodejs服务器的方式。而如果我们..." data-title=" QQ"><i class="icon icon-qq"></i></a></li><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://wuyang910217.github.io/2016/08/06/deploy-meteor-app.html" data-title=" Facebook"><i class="icon icon-facebook"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《超简单，利用Passenger部署Meteor到Ubuntu14.04服务器》 — wuyang的个人博客&url=http://wuyang910217.github.io/2016/08/06/deploy-meteor-app.html&via=http://wuyang910217.github.io" data-title=" Twitter"><i class="icon icon-twitter"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://wuyang910217.github.io/2016/08/06/deploy-meteor-app.html" data-title=" Google+"><i class="icon icon-google-plus"></i></a></li></ul></div><a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle"><i class="icon icon-share-alt icon-lg"></i></a></div></div></div><nav class="post-nav flex-row flex-justify-between"><div class="waves-block waves-effect prev"><a href="/2016/08/08/add-local-meteor-package.html" id="post-prev" class="post-nav-link"><div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div><h4 class="title">修改simple:highlight.js代码高亮的样式</h4></a></div><div class="waves-block waves-effect next"><a href="/2016/08/05/hexo-blog-theme-by-indigo.html" id="post-next" class="post-nav-link"><div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div><h4 class="title">hexo+indigo搭建materail design风格的博客网站</h4></a></div></nav><section class="comments" id="comments"><div id="gitment_thread"></div><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var gitment=new Gitment({owner:"wuyang910217",repo:"blog-comments",oauth:{client_id:"02bfc0f9a2869c803b3b",client_secret:"4d43a7e31355dcb1c23d181408c8ae4336ccea18"}});gitment.render("comments")</script></section></article><div id="reward" class="page-modal reward-lay"><a class="close" href="javascript:;"><i class="icon icon-close"></i></a><h3 class="reward-title"><i class="icon icon-quote-left"></i> ~谢谢打赏~ <i class="icon icon-quote-right"></i></h3><ul class="reward-items"><li><img src="/img/wechat.jpg" title="微信打赏二维码" alt="微信打赏二维码"><p>微信</p></li><li><img src="/img/alipay.jpg" title="支付宝打赏二维码" alt="支付宝打赏二维码"><p>支付宝</p></li></ul></div></div><footer class="footer"><div class="top"><p><span id="busuanzi_container_site_uv" style="display:none">站点总访客数：<span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" style="display:none">站点总访问量：<span id="busuanzi_value_site_pv"></span></span></p><p><span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span> <span>博客内容遵循 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0协议</a></span></p></div><div class="bottom"><p><span>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></span> <span>wuyang的个人博客 &copy; 2016 - 2019</span></p></div></footer></main><div class="mask" id="mask"></div><a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a><div class="global-share" id="globalShare"><ul class="reset share-icons"><li><a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://wuyang910217.github.io/2016/08/06/deploy-meteor-app.html&title=《超简单，利用Passenger部署Meteor到Ubuntu14.04服务器》 — wuyang的个人博客&pic=http://wuyang910217.github.io/img/avatar.jpg" data-title="微博"><i class="icon icon-weibo"></i></a></li><li><a class="weixin share-sns wxFab" href="javascript:;" data-title="微信"><i class="icon icon-weixin"></i></a></li><li><a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://wuyang910217.github.io/2016/08/06/deploy-meteor-app.html&title=《超简单，利用Passenger部署Meteor到Ubuntu14.04服务器》 — wuyang的个人博客&source=简介目前能够方便地部署Meteor app的方法还不多，一般都是用官网的Galaxy或者meteor up或者按照部署Nodejs服务器的方式。而如果我们..." data-title=" QQ"><i class="icon icon-qq"></i></a></li><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://wuyang910217.github.io/2016/08/06/deploy-meteor-app.html" data-title=" Facebook"><i class="icon icon-facebook"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《超简单，利用Passenger部署Meteor到Ubuntu14.04服务器》 — wuyang的个人博客&url=http://wuyang910217.github.io/2016/08/06/deploy-meteor-app.html&via=http://wuyang910217.github.io" data-title=" Twitter"><i class="icon icon-twitter"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://wuyang910217.github.io/2016/08/06/deploy-meteor-app.html" data-title=" Google+"><i class="icon icon-google-plus"></i></a></li></ul></div><div class="page-modal wx-share" id="wxShare"><a class="close" href="javascript:;"><i class="icon icon-close"></i></a><p>扫一扫，分享到微信</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACt0lEQVR42u3aMXLCQAwFUO5/aTKTlth8SStI8bZiwLH3bWEpkh6PeD1/1+vn12ter3y9/urK+6ffXzNaeHh4eK2tX61k69Xrr47s/iCSp/9xBHh4eHhrvCQYJFvshZP7p/TuhoeHh/cfeEn6m4SNJFHOgwoeHh7e/+flZYhe8Kim43h4eHjf4iXFhd4m7kmT9P1wrQUPDw8v5k0aYN/6/KH+Hh4eHl6xq37ghRs8cfLrm93i4eHhLfDyFDZPf08VcKvHWviPAQ8PD2/MqxZk80GopACRY6pX4uHh4e3xRu2lQ82wZA/NkIOHh4d3lNdrKVXLBEnim7fNCg02PDw8vDVe3nBKygfzca48RL1Jr/Hw8PAWeNVi7iTtrg5p5cl3BMbDw8Nb4CUb7R1Bsrnk/tVSLx4eHt4Gb5685n+VDygs1lrw8PDwxrx89YJENQmex7cyDA8PD6/Iqw4wzZPjvEA8KTdcNsDw8PDwxrzqKFUeMPKjyVPnauKOh4eHt8HrlVzzZLqay+fBpllrwcPDwzvESwoBSTpbPZrJkUX3x8PDw1vg3Se++ShA8qJPChN5Cl7YFR4eHt4Cb9I3OzVMkBdwJ0k5Hh4e3ines7h6L+vtYQI8PDy8z/AmQ075oFX1RZ/D3oDx8PDwFnjVAanm2FMx1a5GtjcBCQ8PD+8obzL2dLagUG2tRcMEeHh4eMu8CaBXvDh1lJfHioeHh7fAy0sA+XaT1dziJH3Hw8PDO8TbaH3l51oNEvf7iVJqPDw8vDFv/vLNyxD5Sz9ps03Sbjw8PLw5b1JKOFWizUkHKi54eHh4h3j5C7pXlp1/3yxe4OHh4X2VVx0RmBQpJgXfZmDAw8PDW+NVH18NKpM74OHh4X2SNx8dODVGkJcnom/w8PDwFnjVTVRb/tWtPFvrMVl4eHh4Ke8HOWsDJ6TGwJ0AAAAASUVORK5CYII=" alt="微信分享二维码"></div><script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script><script>var BLOG={ROOT:"/",SHARE:!0,REWARD:!0}</script><script src="//unpkg.com/hexo-theme-material-indigo@1.5.2/js/main.min.js"></script><div class="search-panel" id="search-panel"><ul class="search-result" id="search-result"></ul></div><template id="search-tpl"><li class="item"><a href="{path}" class="waves-block waves-effect"><div class="title ellipsis" title="{title}">{title}</div><div class="flex-row flex-middle"><div class="tags ellipsis">{tags}</div><time class="flex-col time">{date}</time></div></a></li></template><script src="//unpkg.com/hexo-theme-material-indigo@1.5.2/js/search.min.js" async></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js?t=1546743305244").then(function(){console.log("ServiceWorker Register Successfully.")})["catch"](function(e){console.error(e)})</script></body></html><!-- rebuild by neat -->